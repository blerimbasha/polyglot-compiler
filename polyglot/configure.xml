<project name="polyglot-configure" default="instructions" basedir=".">
  <description>
    Polyglot configure file
  </description>

  <target name="instructions" 
          description="Tell the user the instructions for using this build file">
    <echo>
This build file is meant to only be used from the main buildfile build.xml.
Use "ant -file build.xml configure"
    </echo>
    <fail/>
  </target>

  <target name="configure" 
          description="Configure Polyglot" 
          depends="check-classpath,polyglot-executables">
    <delete file="${bin}/defs"/>
    <echo message="java version is ${java.version}"/>
    <echo message="current directory is ${user.dir}"/>
    <echo message="Java home directory is ${java.home}"/>
  </target>

  <target name="check-classpath" description="Check the classpath contains the appropriate directories/jars">
<!--    <available classname="java_cup.Main" property="cp_existence.java_cup"/>
    <available classname="JFlex.Main" property="cp_existence.jlex"/>
    <fail unless="cp_existence.java_cup" 
          message="The java_cup classes must be on the classpath. Try adding java_cup.jar to the classpath."/>
    <fail unless="cp_existence.jlex" 
          message="The JFlex classes must be on the classpath. Try adding jlex.jar to the classpath."/>
-->
  </target>

  <target name="executable-defs" description="creates a file containing common environment variable definitions">
    <echo message="Creating ${bin}/defs"/>
    <echo file="${bin}/defs" append="no">#!/bin/sh
# DO NOT EDIT - This file was automatically generated.

JAVA='${java.home}/bin/java'
FILE_SEP='${file.separator}'
PATH_SEP='${path.separator}'
TOP='${basedir}'
    </echo>
  </target>

  <target name="polyglot-executables" 
          depends="executable-defs" 
          description="creates the executable script jlc">
    <!-- Create jlc -->
    <echo message="Creating ${bin}/jlc"/>
    <concat destfile="${bin}/jlc" append="no">
      <filelist dir="${bin}" files="defs"/>
    </concat>
    <concat destfile="${bin}/jlc" append="yes">
ext=""
    </concat>
    <concat destfile="${bin}/jlc" append="yes">
      <filelist dir="${bin}" files="jlc.in"/>
    </concat>
    <chmod perm="+x" file="${bin}/jlc"/>
  </target>



  <!-- Configure a single extension
       @param ${ext}         the name of the extension 
    -->
  <target name="configure-ext">
    <available file="configure-${ext}.xml" property="configure-ext.configure-available"/>
    <antcall target="configure-ext-conditional"/>
  </target>
  <target name="configure-ext-conditional" 
          if="configure-ext.configure-available">
    <antcall target="executable-defs"/>
    <ant antfile="configure-${ext}.xml" target="configure" inheritRefs="true"/>
    <delete file="${bin}/defs"/>
  </target>


</project>

